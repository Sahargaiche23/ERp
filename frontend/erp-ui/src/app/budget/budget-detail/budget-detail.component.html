<div class="budget-detail-container" *ngIf="!loading">
  <div class="header">
    <button class="btn btn-secondary" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Retour
    </button>
    <h2>Détails du Budget - {{ budget?.department }}</h2>
    <button class="btn btn-primary" (click)="editBudget()">
      <i class="fas fa-edit"></i> Modifier
    </button>
  </div>

  <div class="budget-info-card" *ngIf="budget">
    <div class="row">
      <div class="col-md-6">
        <div class="info-section">
          <h3>Informations Générales</h3>
          <div class="info-item">
            <label>Département:</label>
            <span>{{ budget.department }}</span>
          </div>
          <div class="info-item">
            <label>Année:</label>
            <span>{{ budget.year }}</span>
          </div>
          <div class="info-item">
            <label>Statut:</label>
            <span class="badge" [ngClass]="'badge-' + budget.status?.toLowerCase()">
              {{ budget.status }}
            </span>
          </div>
          <div class="info-item">
            <label>Date de création:</label>
            <span>{{ budget.createdAt | date:'dd/MM/yyyy' }}</span>
          </div>
        </div>
      </div>
      
      <div class="col-md-6">
        <div class="financial-section">
          <h3>Informations Financières</h3>
          <div class="financial-item">
            <label>Budget Alloué:</label>
            <span class="amount allocated">{{ budget.totalAllocated | currency:'EUR':'symbol':'1.0-0' }}</span>
          </div>
          <div class="financial-item">
            <label>Montant Dépensé:</label>
            <span class="amount spent">{{ budget.totalSpent | currency:'EUR':'symbol':'1.0-0' }}</span>
          </div>
          <div class="financial-item">
            <label>Montant Restant:</label>
            <span class="amount remaining">{{ getRemainingAmount() | currency:'EUR':'symbol':'1.0-0' }}</span>
          </div>
          <div class="financial-item">
            <label>Taux d'Utilisation:</label>
            <span class="percentage">{{ getUtilizationPercentage() }}%</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Barre de progression -->
    <div class="progress-section">
      <h4>Utilisation du Budget</h4>
      <div class="progress-bar-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getUtilizationPercentage()"></div>
        </div>
        <span class="progress-text">{{ getUtilizationPercentage() }}% utilisé</span>
      </div>
    </div>

    <!-- Description -->
    <div class="description-section" *ngIf="budget.description">
      <h4>Description</h4>
      <p>{{ budget.description }}</p>
    </div>
  </div>

  <!-- Projets Liés -->
  <div class="related-projects" *ngIf="projects.length > 0">
    <h3>Projets Liés ({{ projects.length }})</h3>
    <div class="projects-grid">
      <div class="project-card" *ngFor="let project of projects">
        <div class="project-header">
          <h4>{{ project.name }}</h4>
          <span class="badge" [ngClass]="'badge-' + project.status?.toLowerCase()">
            {{ project.status }}
          </span>
        </div>
        <div class="project-info">
          <div class="project-budget">
            <label>Budget:</label>
            <span>{{ project.budget | currency:'EUR':'symbol':'1.0-0' }}</span>
          </div>
          <div class="project-spent">
            <label>Dépensé:</label>
            <span>{{ project.spent | currency:'EUR':'symbol':'1.0-0' }}</span>
          </div>
          <div class="project-progress">
            <label>Progrès:</label>
            <div class="mini-progress">
              <div class="mini-progress-fill" [style.width.%]="project.progress || 0"></div>
            </div>
            <span>{{ project.progress || 0 }}%</span>
          </div>
        </div>
        <div class="project-dates">
          <small>
            Du {{ project.startDate | date:'dd/MM/yyyy' }} 
            au {{ project.endDate | date:'dd/MM/yyyy' }}
          </small>
        </div>
      </div>
    </div>
  </div>

  <!-- Actions -->
  <div class="actions-section">
    <button class="btn btn-success" (click)="editBudget()">
      <i class="fas fa-edit"></i> Modifier le Budget
    </button>
    <button class="btn btn-info" routerLink="/admin/budgets">
      <i class="fas fa-list"></i> Voir Tous les Budgets
    </button>
    <button class="btn btn-warning" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Retour à la Liste
    </button>
  </div>
</div>

<div class="loading-container" *ngIf="loading">
  <div class="spinner"></div>
  <p>Chargement des détails du budget...</p>
</div>
