{"ast":null,"code":"import { BehaviorSubject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nexport let NotificationService = /*#__PURE__*/(() => {\n  class NotificationService {\n    notificationsSubject = new BehaviorSubject([]);\n    notifications$ = this.notificationsSubject.asObservable();\n    constructor() {\n      // Charger les notifications du localStorage au d√©marrage\n      this.loadNotifications();\n    }\n    loadNotifications() {\n      const stored = localStorage.getItem('notifications');\n      if (stored) {\n        try {\n          const notifications = JSON.parse(stored);\n          this.notificationsSubject.next(notifications);\n        } catch (e) {\n          console.error('Error loading notifications:', e);\n        }\n      }\n    }\n    saveNotifications() {\n      localStorage.setItem('notifications', JSON.stringify(this.notificationsSubject.value));\n    }\n    getNotifications() {\n      return this.notifications$;\n    }\n    getUnreadCount() {\n      return this.notificationsSubject.value.filter(n => !n.read).length;\n    }\n    createNotification(notification) {\n      const newNotification = {\n        ...notification,\n        id: this.generateId(),\n        createdAt: new Date()\n      };\n      const current = this.notificationsSubject.value;\n      this.notificationsSubject.next([newNotification, ...current]);\n      this.saveNotifications();\n    }\n    markAsRead(id) {\n      const updated = this.notificationsSubject.value.map(n => n.id === id ? {\n        ...n,\n        read: true\n      } : n);\n      this.notificationsSubject.next(updated);\n      this.saveNotifications();\n    }\n    markAllAsRead() {\n      const updated = this.notificationsSubject.value.map(n => ({\n        ...n,\n        read: true\n      }));\n      this.notificationsSubject.next(updated);\n      this.saveNotifications();\n    }\n    deleteNotification(id) {\n      const updated = this.notificationsSubject.value.filter(n => n.id !== id);\n      this.notificationsSubject.next(updated);\n      this.saveNotifications();\n    }\n    clearAll() {\n      this.notificationsSubject.next([]);\n      localStorage.removeItem('notifications');\n    }\n    generateId() {\n      return `notif_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    }\n    // Notifications sp√©cifiques\n    notifyClaimCreated(claimId, citizenName, subject) {\n      this.createNotification({\n        userId: 'chief',\n        // Envoyer au CHIEF\n        type: 'CLAIM_CREATED',\n        title: 'üìù Nouvelle R√©clamation',\n        message: `${citizenName} a cr√©√© une r√©clamation: \"${subject}\"`,\n        claimId,\n        read: false\n      });\n    }\n    notifyClaimAssigned(claimId, agentName, subject) {\n      this.createNotification({\n        userId: 'agent',\n        // Envoyer √† l'AGENT\n        type: 'CLAIM_ASSIGNED',\n        title: 'üìã R√©clamation Assign√©e',\n        message: `Vous avez √©t√© assign√© √†: \"${subject}\"`,\n        claimId,\n        read: false\n      });\n    }\n    notifyClaimStatusChanged(claimId, status, subject) {\n      this.createNotification({\n        userId: 'citizen',\n        // Envoyer au CITIZEN\n        type: 'CLAIM_STATUS_CHANGED',\n        title: 'üîî Statut Mis √† Jour',\n        message: `Votre r√©clamation \"${subject}\" est maintenant: ${status}`,\n        claimId,\n        read: false\n      });\n    }\n    static …µfac = function NotificationService_Factory(t) {\n      return new (t || NotificationService)();\n    };\n    static …µprov = /*@__PURE__*/i0.…µ…µdefineInjectable({\n      token: NotificationService,\n      factory: NotificationService.…µfac,\n      providedIn: 'root'\n    });\n  }\n  return NotificationService;\n})();","map":{"version":3,"names":["BehaviorSubject","NotificationService","notificationsSubject","notifications$","asObservable","constructor","loadNotifications","stored","localStorage","getItem","notifications","JSON","parse","next","e","console","error","saveNotifications","setItem","stringify","value","getNotifications","getUnreadCount","filter","n","read","length","createNotification","notification","newNotification","id","generateId","createdAt","Date","current","markAsRead","updated","map","markAllAsRead","deleteNotification","clearAll","removeItem","now","Math","random","toString","substr","notifyClaimCreated","claimId","citizenName","subject","userId","type","title","message","notifyClaimAssigned","agentName","notifyClaimStatusChanged","status","factory","…µfac","providedIn"],"sources":["/home/sahar/Bureau/ERp/frontend/erp-ui/src/app/services/notification.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { Notification } from '../models/notification.model';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class NotificationService {\n  private notificationsSubject = new BehaviorSubject<Notification[]>([]);\n  public notifications$ = this.notificationsSubject.asObservable();\n\n  constructor() {\n    // Charger les notifications du localStorage au d√©marrage\n    this.loadNotifications();\n  }\n\n  private loadNotifications(): void {\n    const stored = localStorage.getItem('notifications');\n    if (stored) {\n      try {\n        const notifications = JSON.parse(stored);\n        this.notificationsSubject.next(notifications);\n      } catch (e) {\n        console.error('Error loading notifications:', e);\n      }\n    }\n  }\n\n  private saveNotifications(): void {\n    localStorage.setItem('notifications', JSON.stringify(this.notificationsSubject.value));\n  }\n\n  getNotifications(): Observable<Notification[]> {\n    return this.notifications$;\n  }\n\n  getUnreadCount(): number {\n    return this.notificationsSubject.value.filter(n => !n.read).length;\n  }\n\n  createNotification(notification: Omit<Notification, 'id' | 'createdAt'>): void {\n    const newNotification: Notification = {\n      ...notification,\n      id: this.generateId(),\n      createdAt: new Date()\n    };\n\n    const current = this.notificationsSubject.value;\n    this.notificationsSubject.next([newNotification, ...current]);\n    this.saveNotifications();\n  }\n\n  markAsRead(id: string): void {\n    const updated = this.notificationsSubject.value.map(n =>\n      n.id === id ? { ...n, read: true } : n\n    );\n    this.notificationsSubject.next(updated);\n    this.saveNotifications();\n  }\n\n  markAllAsRead(): void {\n    const updated = this.notificationsSubject.value.map(n => ({ ...n, read: true }));\n    this.notificationsSubject.next(updated);\n    this.saveNotifications();\n  }\n\n  deleteNotification(id: string): void {\n    const updated = this.notificationsSubject.value.filter(n => n.id !== id);\n    this.notificationsSubject.next(updated);\n    this.saveNotifications();\n  }\n\n  clearAll(): void {\n    this.notificationsSubject.next([]);\n    localStorage.removeItem('notifications');\n  }\n\n  private generateId(): string {\n    return `notif_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  // Notifications sp√©cifiques\n  notifyClaimCreated(claimId: string, citizenName: string, subject: string): void {\n    this.createNotification({\n      userId: 'chief', // Envoyer au CHIEF\n      type: 'CLAIM_CREATED',\n      title: 'üìù Nouvelle R√©clamation',\n      message: `${citizenName} a cr√©√© une r√©clamation: \"${subject}\"`,\n      claimId,\n      read: false\n    });\n  }\n\n  notifyClaimAssigned(claimId: string, agentName: string, subject: string): void {\n    this.createNotification({\n      userId: 'agent', // Envoyer √† l'AGENT\n      type: 'CLAIM_ASSIGNED',\n      title: 'üìã R√©clamation Assign√©e',\n      message: `Vous avez √©t√© assign√© √†: \"${subject}\"`,\n      claimId,\n      read: false\n    });\n  }\n\n  notifyClaimStatusChanged(claimId: string, status: string, subject: string): void {\n    this.createNotification({\n      userId: 'citizen', // Envoyer au CITIZEN\n      type: 'CLAIM_STATUS_CHANGED',\n      title: 'üîî Statut Mis √† Jour',\n      message: `Votre r√©clamation \"${subject}\" est maintenant: ${status}`,\n      claimId,\n      read: false\n    });\n  }\n}\n"],"mappings":"AACA,SAASA,eAAe,QAAoB,MAAM;;AAMlD,WAAaC,mBAAmB;EAA1B,MAAOA,mBAAmB;IACtBC,oBAAoB,GAAG,IAAIF,eAAe,CAAiB,EAAE,CAAC;IAC/DG,cAAc,GAAG,IAAI,CAACD,oBAAoB,CAACE,YAAY,EAAE;IAEhEC,YAAA;MACE;MACA,IAAI,CAACC,iBAAiB,EAAE;IAC1B;IAEQA,iBAAiBA,CAAA;MACvB,MAAMC,MAAM,GAAGC,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC;MACpD,IAAIF,MAAM,EAAE;QACV,IAAI;UACF,MAAMG,aAAa,GAAGC,IAAI,CAACC,KAAK,CAACL,MAAM,CAAC;UACxC,IAAI,CAACL,oBAAoB,CAACW,IAAI,CAACH,aAAa,CAAC;QAC/C,CAAC,CAAC,OAAOI,CAAC,EAAE;UACVC,OAAO,CAACC,KAAK,CAAC,8BAA8B,EAAEF,CAAC,CAAC;QAClD;MACF;IACF;IAEQG,iBAAiBA,CAAA;MACvBT,YAAY,CAACU,OAAO,CAAC,eAAe,EAAEP,IAAI,CAACQ,SAAS,CAAC,IAAI,CAACjB,oBAAoB,CAACkB,KAAK,CAAC,CAAC;IACxF;IAEAC,gBAAgBA,CAAA;MACd,OAAO,IAAI,CAAClB,cAAc;IAC5B;IAEAmB,cAAcA,CAAA;MACZ,OAAO,IAAI,CAACpB,oBAAoB,CAACkB,KAAK,CAACG,MAAM,CAACC,CAAC,IAAI,CAACA,CAAC,CAACC,IAAI,CAAC,CAACC,MAAM;IACpE;IAEAC,kBAAkBA,CAACC,YAAoD;MACrE,MAAMC,eAAe,GAAiB;QACpC,GAAGD,YAAY;QACfE,EAAE,EAAE,IAAI,CAACC,UAAU,EAAE;QACrBC,SAAS,EAAE,IAAIC,IAAI;OACpB;MAED,MAAMC,OAAO,GAAG,IAAI,CAAChC,oBAAoB,CAACkB,KAAK;MAC/C,IAAI,CAAClB,oBAAoB,CAACW,IAAI,CAAC,CAACgB,eAAe,EAAE,GAAGK,OAAO,CAAC,CAAC;MAC7D,IAAI,CAACjB,iBAAiB,EAAE;IAC1B;IAEAkB,UAAUA,CAACL,EAAU;MACnB,MAAMM,OAAO,GAAG,IAAI,CAAClC,oBAAoB,CAACkB,KAAK,CAACiB,GAAG,CAACb,CAAC,IACnDA,CAAC,CAACM,EAAE,KAAKA,EAAE,GAAG;QAAE,GAAGN,CAAC;QAAEC,IAAI,EAAE;MAAI,CAAE,GAAGD,CAAC,CACvC;MACD,IAAI,CAACtB,oBAAoB,CAACW,IAAI,CAACuB,OAAO,CAAC;MACvC,IAAI,CAACnB,iBAAiB,EAAE;IAC1B;IAEAqB,aAAaA,CAAA;MACX,MAAMF,OAAO,GAAG,IAAI,CAAClC,oBAAoB,CAACkB,KAAK,CAACiB,GAAG,CAACb,CAAC,KAAK;QAAE,GAAGA,CAAC;QAAEC,IAAI,EAAE;MAAI,CAAE,CAAC,CAAC;MAChF,IAAI,CAACvB,oBAAoB,CAACW,IAAI,CAACuB,OAAO,CAAC;MACvC,IAAI,CAACnB,iBAAiB,EAAE;IAC1B;IAEAsB,kBAAkBA,CAACT,EAAU;MAC3B,MAAMM,OAAO,GAAG,IAAI,CAAClC,oBAAoB,CAACkB,KAAK,CAACG,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACM,EAAE,KAAKA,EAAE,CAAC;MACxE,IAAI,CAAC5B,oBAAoB,CAACW,IAAI,CAACuB,OAAO,CAAC;MACvC,IAAI,CAACnB,iBAAiB,EAAE;IAC1B;IAEAuB,QAAQA,CAAA;MACN,IAAI,CAACtC,oBAAoB,CAACW,IAAI,CAAC,EAAE,CAAC;MAClCL,YAAY,CAACiC,UAAU,CAAC,eAAe,CAAC;IAC1C;IAEQV,UAAUA,CAAA;MAChB,OAAO,SAASE,IAAI,CAACS,GAAG,EAAE,IAAIC,IAAI,CAACC,MAAM,EAAE,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE;IACzE;IAEA;IACAC,kBAAkBA,CAACC,OAAe,EAAEC,WAAmB,EAAEC,OAAe;MACtE,IAAI,CAACvB,kBAAkB,CAAC;QACtBwB,MAAM,EAAE,OAAO;QAAE;QACjBC,IAAI,EAAE,eAAe;QACrBC,KAAK,EAAE,yBAAyB;QAChCC,OAAO,EAAE,GAAGL,WAAW,6BAA6BC,OAAO,GAAG;QAC9DF,OAAO;QACPvB,IAAI,EAAE;OACP,CAAC;IACJ;IAEA8B,mBAAmBA,CAACP,OAAe,EAAEQ,SAAiB,EAAEN,OAAe;MACrE,IAAI,CAACvB,kBAAkB,CAAC;QACtBwB,MAAM,EAAE,OAAO;QAAE;QACjBC,IAAI,EAAE,gBAAgB;QACtBC,KAAK,EAAE,yBAAyB;QAChCC,OAAO,EAAE,6BAA6BJ,OAAO,GAAG;QAChDF,OAAO;QACPvB,IAAI,EAAE;OACP,CAAC;IACJ;IAEAgC,wBAAwBA,CAACT,OAAe,EAAEU,MAAc,EAAER,OAAe;MACvE,IAAI,CAACvB,kBAAkB,CAAC;QACtBwB,MAAM,EAAE,SAAS;QAAE;QACnBC,IAAI,EAAE,sBAAsB;QAC5BC,KAAK,EAAE,sBAAsB;QAC7BC,OAAO,EAAE,sBAAsBJ,OAAO,qBAAqBQ,MAAM,EAAE;QACnEV,OAAO;QACPvB,IAAI,EAAE;OACP,CAAC;IACJ;;uBA1GWxB,mBAAmB;IAAA;;aAAnBA,mBAAmB;MAAA0D,OAAA,EAAnB1D,mBAAmB,CAAA2D,IAAA;MAAAC,UAAA,EAFlB;IAAM;;SAEP5D,mBAAmB;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}